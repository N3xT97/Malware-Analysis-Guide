## Java Script

### 자바 스크립트의 기본

var를 사용해 변수 선언. for, while, if, else 등의 키워드는 대부분의 프로그래밍 언어와 같은 동작.

### 악성 자바 스크립트에 자주 사용되는 함수

```javascript
eval            // 평가 표현식
replace         // 문자열에서 부분 문자열의 발생을 대체
split           // 구분 기호를 사용해 문자열 분할
join            // 구분 기호로 두 문자열을 결합
fromCharCode    // 유니코드 값을 문자로 변환
operator        // 문자열 연결
concat          // 문자열 연결
document.write  // HTML 문서에 쓰기
console.log     // 브라우저 콘솔에 쓰기
```

## Malzilla

### 동적 난독화 해제

텍스트 편집기로 악성 자바 스크립트를 확인하게 되면 한눈에 보기 어려운 형태를 가지고 있음.

![481](images/Java%20Script%20분석/IMG-Java%20Script%20분석-20240911161650669.png)

Malzilla의 Format code 기능을 사용하면 어느 정도 보기 좋게 정리해줌.

![481](images/Java%20Script%20분석/IMG-Java%20Script%20분석-20240911161650771.png)

Run script 기능을 사용하면 eval 함수에 전달된 내용을 확인할 수 있음.

![483](images/Java%20Script%20분석/IMG-Java%20Script%20분석-20240911161650882.png)

해당 코드를 다시 복사해서 Format code 기능을 사용하면 의심스러운 문자열들을 확인할 수 있음.

![483](images/Java%20Script%20분석/IMG-Java%20Script%20분석-20240911161650972.png)

## WSCRIPT

간혹 eval 함수를 사용하지 않는 javascript도 존재함. 이때는 wscript를 사용하여 해당 javascript가 어떤 행위를 수행하는지 확인할 수 있음. wscript를 x32dbg로 실행 후 command line에 분석하고자 하는 javascript 파일을 파라미터로 전달.

![300](images/Java%20Script%20분석/IMG-Java%20Script%20분석-20240911161651068.png)

네트워크 관련 기능을 수행하는 ws2_32.dll과 쉘 관련 기능을 수행하는 shell32.dll에 BP를 설정.

![439](images/Java%20Script%20분석/IMG-Java%20Script%20분석-20240911161651154.png)

shell32.dll이 로드되고 BP가 걸리면, ShellExecute API 들에 BP를 설정 후 앞서 걸었던 shell32.dll BP 제거 후 진행.

![399](images/Java%20Script%20분석/IMG-Java%20Script%20분석-20240911161651260.png)

![483](images/Java%20Script%20분석/IMG-Java%20Script%20분석-20240911161651339.png)

ShellExecuteEx에 전달되는 파라미터를 확인. javascript가 하고자하는 행위를 확인할 수 있음.

![399](images/Java%20Script%20분석/IMG-Java%20Script%20분석-20240911161651423.png)

![483](images/Java%20Script%20분석/IMG-Java%20Script%20분석-20240911161651504.png)