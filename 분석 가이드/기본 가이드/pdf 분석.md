## this.exportDataObject를 악용한 파일 drop

### 1. 의심스러운 문자열 부분이 있는지 확인

pdf 분석 도구 peepdf를 사용하여 pdf 내부를 확인.

```powershell
peepdf.py -i [file_path]
```

![](images/pdf%20분석/IMG-pdf%20분석-20240910201708609.png)

의심스러운 Object 번호 확인 가능. => 1, 8, 9   

### 2. 의심스러운 Object 확인

OpenAction이 존재하는 `Object 1` 확인.

![](images/pdf%20분석/IMG-pdf%20분석-20240910202038067.png)

OpenAction은 object 9에, eicar-dropper.doc라는 임베디드 파일은 object 7에 관련 정보가 존재. OpenAction 관련 정보를 얻기 위해 object 9를 확인.

![](images/pdf%20분석/IMG-pdf%20분석-20240910202527122.png)

pdf 파일 내에 존재하는 첨부 파일을 저장 및 실행하는 `this.exportDataObject` 명령어가 존재.

```javascript
this.exportDataObject({
    cName: "첨부파일이름",
    nLaunch: 0 
});

// cName: PDF 내에 첨부된 파일 이름
// nLaunch: 내보낸 파일을 자동으로 여는 옵션 
//   0: 파일 저장 (사용자가 지정한 저장 경로)
//   1: 파일 저장 및 실행 (사용자가 지정한 저장 경로)
//   2: 파일 저장 및 실행 (임시경로에 저장, 사용자에게 저장경로를 묻지 않음)
```

acrobat으로 해당 파일을 열었을 시, 다음과 같은 알림창이 활성화되는데 OK를 누르면 첨부파일이 자동으로 저장 및 실행됨.
![](images/pdf%20분석/IMG-pdf%20분석-20240910213404310.png)

eicar-dropper.doc가 존재하는 object 7을 확인.

![](images/pdf%20분석/IMG-pdf%20분석-20240910203610911.png)

파일 내용은 object 8에 존재하므로, object 8을 확인.

![](images/pdf%20분석/IMG-pdf%20분석-20240910204026315.png)

FlateDecode가 확인 가능한 것으로 보아 암호화된 EmbeddedFile이 존재한다는 것을 알 수 있음. stream 명령어를 사용하여 stream 정보를 확인.

![](images/pdf%20분석/IMG-pdf%20분석-20240910224211707.png)

ms office에서 사용하는 CFBF 포맷의 파일 시그니처를 확인할 수 있음. peepdf를 사용하면 간단히 object 8을 복호화하여 덤프 가능.

![](images/pdf%20분석/IMG-pdf%20분석-20240910224425357.png)

![](images/pdf%20분석/IMG-pdf%20분석-20240910204912382.png)

### 3. Drop된 파일을 분석

이어서 Drop된 doc 파일을 분석하면 됨.

![](images/pdf%20분석/IMG-pdf%20분석-20240910224548077.png)