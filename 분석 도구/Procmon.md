---
os:
  - win10
  - win11
type:
  - mnt
생성 일시: Invalid date
최종 편집 일시: Invalid date
---
## ▶️ Procmon

> [!info] 프로세스 모니터 - Sysinternals  
> 파일 시스템, 레지스트리, 프로세스, 스레드 및 DLL 활동을 실시간으로 모니터링합니다.  
> [https://learn.microsoft.com/ko-kr/sysinternals/downloads/procmon](https://learn.microsoft.com/ko-kr/sysinternals/downloads/procmon)  

## ✅ 프로세스 모니터를 이용한 모니터링

---

- ProcMon은 특정 레지스트리, 파일 시스템, 네트워크, 프로세스와 스레드 행위를 모니터링 가능
- ProcMon은 많은 데이터를 수집하지만, 다음과 같은 데이터는 놓칠 수 있음
    - SetWindowsHookEx 같은 특정 GUI 호출
    - 장치 I/O 제어를 통한 루트킷
    - 대화하는 사용자 모드 컴포넌트의 장치 드라이버 행위
- 윈도우 버전에 따라 일관성 있게 동작하지 않으므로 네트워크 행위를 로깅하는 용도로는 사용할 수 없음
- ProcMon은 동작과 동시에 모든 시스템 호출을 감시하고 결과를 수집할 때 메모리를 사용
    
    ⇒ 가상 머신에서 사용할 수 있는 메모리를 모두 소진하면 가상 머신이 다운될 수도 있음
    
    ⇒ 악성 코드를 실행하기 전에 Clear Display를 통해 데이터를 삭제 후, Capture Events를 통해 모니터링해야 함
    
    ⇒ 악성 코드를 실행하고 일정 시간이 지나면 이벤트 수집을 중단해야 함
    

### 🔸 ProcMon 화면

- 이벤트에 관한 다양한 정보를 설정 가능한 칼럼을 표시
    
    - 이벤트의 시퀀스 번호, 타임 스탬프, 이벤트의 원인이 되는 프로세스명, 이벤트 오퍼레이션,  
        이벤트 사용 경로, 이벤트 결과 등  
        
    
    ![[images/Procmon/IMG-Procmon-20240818160208295.png|IMG-Procmon-20240818160208295.png]]
    
- 행을 더블 클릭하면 이벤트에 대한 세부 정보를 볼 수 있음
    
    ![[images/Procmon/IMG-Procmon-20240818160211320.png|IMG-Procmon-20240818160211320.png]]
    

### 🔸 ProcMon을 이용한 필터링

- 수만 개의 이벤트가 존재하므로 필터링 기능이 매우 유용
    
    ![[images/Procmon/IMG-Procmon-20240818160213654.png|IMG-Procmon-20240818160213654.png]]
    
    - ProcMon에서는 시스템에 동작하는 하나의 실행 파일만 볼 수 있게 필터링 가능
    - RegSetValue, CreateFile, WriteFile이나 다른 의심스럽거나 파괴적인 동작을 필터링 가능
- 필터링은 설정된 이벤트만 저장되는 것이 아니라, 이미 저장된 모든 이벤트들 중에서 필터링되어 보여지는 것
    
    ⇒ 필터링 사용이 과한 메모리 사용을 줄이는 방법이 아님
    
- 중요한 필터링 항목
    - 중요한 항목 = Process Name, Operation, Detail
    - 중요한 비교 연산자 = is, Contains, Less Than
- ProcMon은 툴바에서 자동으로 필터를 걸 수 있음
    
    ![[images/Procmon/IMG-Procmon-20240818160215826.png|IMG-Procmon-20240818160215826.png]]
    
    - Registry = 레지스트리 동작을 검사해 레지스트리 내에 악성코드 흔적이 어떻게 남는지 보여줌
    - File system = 파일 시스템을 탐색해 악성 코드가 생성한 파일이나 설정에 사용한 파일을 모두 보여줌
    - Process activity = 프로세스 행위를 검사해 또 다른 프로세스를 생성했는지 알려줌
    - Network = 네트워크 연결을 통해 악성 코드가 리스닝하는 포트를 보여줌
- 부팅 시 실행되는 악성 코드의 경우, 시작 이벤트를 캡처할 수 있는 ProcMon의 부트 로깅 옵션을 사용하면 됨
    - Option > Enable Boot Logging